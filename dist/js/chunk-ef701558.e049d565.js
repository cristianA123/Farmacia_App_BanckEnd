(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef701558"],{"4bd4":function(e,t,a){"use strict";var n=a("5530"),i=(a("caad"),a("2532"),a("07ac"),a("4de4"),a("159b"),a("7db0"),a("58df")),s=a("7e2b"),r=a("3206");t["a"]=Object(i["a"])(s["a"],Object(r["b"])("form")).extend({name:"v-form",provide:function(){return{form:this}},inheritAttrs:!1,props:{disabled:Boolean,lazyValidation:Boolean,readonly:Boolean,value:Boolean},data:function(){return{inputs:[],watchers:[],errorBag:{}}},watch:{errorBag:{handler:function(e){var t=Object.values(e).includes(!0);this.$emit("input",!t)},deep:!0,immediate:!0}},methods:{watchInput:function(e){var t=this,a=function(e){return e.$watch("hasError",(function(a){t.$set(t.errorBag,e._uid,a)}),{immediate:!0})},n={_uid:e._uid,valid:function(){},shouldValidate:function(){}};return this.lazyValidation?n.shouldValidate=e.$watch("shouldValidate",(function(i){i&&(t.errorBag.hasOwnProperty(e._uid)||(n.valid=a(e)))})):n.valid=a(e),n},validate:function(){return 0===this.inputs.filter((function(e){return!e.validate(!0)})).length},reset:function(){this.inputs.forEach((function(e){return e.reset()})),this.resetErrorBag()},resetErrorBag:function(){var e=this;this.lazyValidation&&setTimeout((function(){e.errorBag={}}),0)},resetValidation:function(){this.inputs.forEach((function(e){return e.resetValidation()})),this.resetErrorBag()},register:function(e){this.inputs.push(e),this.watchers.push(this.watchInput(e))},unregister:function(e){var t=this.inputs.find((function(t){return t._uid===e._uid}));if(t){var a=this.watchers.find((function(e){return e._uid===t._uid}));a&&(a.valid(),a.shouldValidate()),this.watchers=this.watchers.filter((function(e){return e._uid!==t._uid})),this.inputs=this.inputs.filter((function(e){return e._uid!==t._uid})),this.$delete(this.errorBag,t._uid)}}},render:function(e){var t=this;return e("form",{staticClass:"v-form",attrs:Object(n["a"])({novalidate:!0},this.attrs$),on:{submit:function(e){return t.$emit("submit",e)}}},this.$slots.default)}})},fb4a:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d-flex flex-column flex-grow-1"},[a("div",{staticClass:"d-flex align-center py-3"},[e._m(0),a("v-spacer"),a("v-btn",{attrs:{outlined:"",color:"primary",loading:e.isLoadingDownload},on:{click:e.descargarExcel}},[a("v-icon",[e._v("mdi-progress-download")])],1),a("BtnToReload")],1),a("TableReportComponent",{attrs:{headers:e.headers,items:e.reports,search_text:e.search_text,"is-loading":e.isLoading},on:{onfilter:e.on_filter,onreadyusers:e.onreadyusers,onDetail:e.onDetail}})],1)},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"display-1"},[e._v("Reporte de servicios")])])}],s=a("2909"),r=(a("7db0"),a("a434"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("FiltersReportComponent",{on:{onfilter:e.onfilter,onreadyfilters:e.onreadyfilters,onreadyusers:e.onreadyusers}}),a("v-card",[a("v-card-title",[e._v(" Resultados: "),a("v-spacer"),a("v-text-field",{staticClass:"flex-grow-1 mr-md-2",attrs:{"append-icon":"mdi-magnify",dense:"",clearable:"",placeholder:"Ej.: Filtrar por name, email, empresa, etc"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchUser(e.searchQuery)}},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}})],1),a("v-data-table",{staticClass:"flex-grow-1",attrs:{headers:e.headers,items:e.items,loading:e.isLoading,search:e.searchQuery},scopedSlots:e._u([{key:"item.name",fn:function(t){var n=t.item;return[e._v(" "+e._s(n.name)+" "),a("v-chip",{staticClass:"ma-1",attrs:{outlined:"","x-small":""}},[e._v(" "+e._s(n.service)+" ")]),n.is_bidireccional?a("v-chip",{attrs:{outlined:"","x-small":""}},[a("v-icon",[e._v("mdi-swap-horizontal")])],1):e._e()]}},{key:"item.total_cost",fn:function(t){var a=t.item;return[e._v(" "+e._s(e._f("formatCurrency")(a.total_cost,e.configFormat))+" ")]}},{key:"item.status",fn:function(t){var n=t.item;return[0===n.status?a("v-chip",{staticClass:"ma-2",attrs:{color:"red","text-color":"white",small:""}},[e._v(" Cancelado ")]):e._e(),1===n.status?a("v-chip",{staticClass:"ma-2",attrs:{color:"green","text-color":"white",small:""}},[e._v(" FINALIZADO ")]):e._e(),2===n.status?a("v-chip",{staticClass:"ma-2",attrs:{"text-color":"white",small:"",dark:""}},[e._v(" PENDIENTE ")]):e._e(),3===n.status?a("v-chip",{staticClass:"ma-2",attrs:{small:"",color:"orange",dark:""}},[e._v(" PROCESANDO ")]):e._e(),4===n.status?a("v-chip",{staticClass:"ma-2",attrs:{color:"orange","text-color":"white",small:""}},[e._v(" AGENDADO ")]):e._e()]}},{key:"item.sms_credit_send",fn:function(t){var a=t.item;return[e._v(" "+e._s((new Intl.NumberFormat).format(a.sms_credit_send))+" ")]}},{key:"item.user_name",fn:function(e){var t=e.item;return[a("userAvatar",{attrs:{user:{name:t.user,company:t.company,email:t.email}}})]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.attrs,i=t.on;return[a("v-btn",e._g(e._b({attrs:{text:""}},"v-btn",n,!1),i),[e._v(" Acciones ")])]}}],null,!0)},[a("v-list",[a("v-list-item",{attrs:{link:""},on:{click:function(t){return e.detalle(n)}}},[e._v(" Ver detalle ")])],1)],1)]}}],null,!0)})],1)],1)}),o=[],l=a("bc25"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(t){return t.preventDefault(),e.submit()}},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},[a("v-row",{staticClass:"pb-1"},[a("v-col",{staticClass:"col-12 col-lg-3 py-0 pr-0 d-flex justify-space-between"},[a("ComboboxComponent",{ref:"comboUsers",attrs:{loading:e.isLoadingUsers,icon:"mdi-account",label:"Usuarios"},on:{onChange:e.ChangeSelectedUsers}})],1),e._e(),a("v-col",{staticClass:"col-6 col-lg-3 py-0 pr-0 pd-flex justify-space-between"},[a("v-dialog",{ref:"dialogStart",attrs:{"return-value":e.dateStart,persistent:"",width:"290px"},on:{"update:returnValue":function(t){e.dateStart=t},"update:return-value":function(t){e.dateStart=t}},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,i=t.attrs;return[a("v-text-field",e._g(e._b({staticClass:"flex-grow-1 mr-md-2",attrs:{"append-icon":"mdi-calendar-start",label:"Fecha inicio",outlined:"",readonly:"",dense:"",clearable:"",placeholder:"Fecha inicio",rules:[function(e){return!!e||"Fecha de inicio es obligatorio"}]},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}},"v-text-field",i,!1),n))]}}]),model:{value:e.modalDateRangeStart,callback:function(t){e.modalDateRangeStart=t},expression:"modalDateRangeStart"}},[a("v-date-picker",{attrs:{scrollable:"",max:e.maxDateStart},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.modalDateRangeStart=!1}}},[e._v("Cancelar")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.saveDateStart()}}},[e._v("OK")])],1)],1)],1),a("v-col",{staticClass:"col-6 col-lg-3 py-0 pr-0 d-flex justify-space-between"},[a("v-dialog",{ref:"dialogEnd",attrs:{"return-value":e.dateEnd,persistent:"",width:"290px"},on:{"update:returnValue":function(t){e.dateEnd=t},"update:return-value":function(t){e.dateEnd=t}},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,i=t.attrs;return[a("v-text-field",e._g(e._b({staticClass:"flex-grow-1 mr-md-2",attrs:{"append-icon":"mdi-calendar-end",label:"Fecha fin",readonly:"",outlined:"",dense:"",clearable:"",placeholder:"Fecha fin",rules:[function(e){return!!e||"Fecha fin es obligatorio"}]},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}},"v-text-field",i,!1),n))]}}]),model:{value:e.modalDateRangeEnd,callback:function(t){e.modalDateRangeEnd=t},expression:"modalDateRangeEnd"}},[a("v-date-picker",{attrs:{scrollable:"",min:e.minDateEnd},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.modalDateRangeEnd=!1}}},[e._v("Cancelar")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.saveDateEnd()}}},[e._v("OK")])],1)],1)],1),a("v-col",{staticClass:"col-12 col-lg-2 py-0 d-flex justify-space-between"},[a("v-btn",{staticClass:"flex-grow-1",attrs:{color:"success",type:"submit"}},[a("v-icon",{attrs:{left:""}},[e._v(" mdi-reload ")]),e._v(" Buscar ")],1)],1)],1)],1)},d=[],u=(a("159b"),a("b0c0"),a("c1df")),m=a.n(u),f=a("88f5"),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-select",{staticClass:"flex-grow-1 mr-md-2",attrs:{items:e.items,"item-text":"name","item-value":"id",label:e.label,outlined:"",dense:"",clearable:"",multiple:"",loading:e.loading,placeholder:"Seleccione",rules:[function(e){return 0!==e.length||"Es obligatorio"}]},on:{change:function(t){return e.ifSelectAllItems()}},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[a("v-list-item",{on:{click:e.toggle}},[a("v-list-item-action",[a("v-icon",{attrs:{color:e.selectedItems.length>0?"primary darken-4":""}},[e._v(" "+e._s(e.icon)+" ")])],1),a("v-list-item-content",[a("v-list-item-title",[e._v(" Todos ")])],1)],1),a("v-divider",{staticClass:"mt-2"})]},proxy:!0},{key:"selection",fn:function(t){var n=t.item,i=t.index;return[0===i?a("div",[e._v(" "+e._s(n.name)+" ")]):e._e(),1===i?a("span",{staticClass:"grey--text text-caption"},[e._v(" (+"+e._s(e.selectedItems.length-1)+" más) ")]):e._e()]}}]),model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}})},h=[],p=(a("fb6a"),{props:{loading:{type:Boolean,default:!1},label:{type:String,default:""}},data:function(){return{items:[],selectedItems:[],allSelect:!0}},computed:{computedSelectedItems:function(){var e=[];return this.selectedItems.forEach((function(t){e.push(t.id)})),e},likesAllItem:function(){return this.selectedItems.length===this.items.length},likesSomeItem:function(){return this.selectedItems.length>0&&!this.likesAllItem},icon:function(){return this.likesAllItem?"mdi-close-box":this.likesSomeItem?"mdi-minus-box":"mdi-checkbox-blank-outline"}},mounted:function(){this.ifSelectAllItems()},methods:{list:function(e){this.items=e,this.selectedItems=this.items,this.ifSelectAllItems()},ifSelectAllItems:function(){var e;null!==(e=this.selectedItems[0])&&void 0!==e&&e.id?this.$emit("onChange",this.computedSelectedItems):this.$emit("onChange",this.selectedItems)},toggle:function(){var e=this;this.$nextTick((function(){e.likesAllItem?e.selectedItems=[]:e.selectedItems=e.items.slice()}))}}}),g=p,_=a("2877"),b=a("6544"),y=a.n(b),x=a("ce7e"),S=a("132d"),C=a("da13"),k=a("1800"),E=a("5d23"),w=a("b974"),D=Object(_["a"])(g,v,h,!1,null,null,null),I=D.exports;y()(D,{VDivider:x["a"],VIcon:S["a"],VListItem:C["a"],VListItemAction:k["a"],VListItemContent:E["a"],VListItemTitle:E["c"],VSelect:w["a"]});var V={components:{ComboboxComponent:I},data:function(){return{validForm:!0,services:[{id:0,name:"Todos"},{id:1,name:"SMS"},{id:2,name:"IVR"},{id:3,name:"WHATSAPP"},{id:4,name:"MAILLING"}],selectedServices:[],isLoadingServices:!1,selectedUsers:[],isLoadingUsers:!1,maxDateStart:null,dateStart:null,minDateEnd:null,dateEnd:null,modalDateRangeStart:null,modalDateRangeEnd:null,isLoading:!1}},computed:{computedDateFormat:function(){return m()(Date.now()).format("YYYY-MM-DD")}},mounted:function(){this.getUsers(),this.dateStart=this.computedDateFormat,this.dateEnd=this.computedDateFormat},methods:{getUsers:function(){var e=this;this.isLoadingUsers=!0,f["a"].get("/userforreport").then((function(t){var a=[],n=[];t.data.data.forEach((function(e){a.push({id:e.id,name:e.name}),n.push(e.id)})),e.isLoadingUsers=!1,e.$refs.comboUsers.list(a),e.$emit("onreadyusers",n)}))},getServices:function(){this.isLoadingServices=!0;var e=[{id:0,name:"Todos"},{id:1,name:"Sms"},{id:2,name:"Ivr"}];this.isLoadingServices=!1,this.$refs.comboServices.list(e)},saveDateStart:function(){this.$refs.dialogStart.save(this.dateStart),this.minDateEnd=new Date(this.dateStart).toISOString()},saveDateEnd:function(){this.$refs.dialogEnd.save(this.dateEnd),this.maxDateStart=new Date(this.dateEnd).toISOString()},submit:function(){if(this.$refs.form.validate()){var e={users:this.selectedUsers,services:[0,1,2],start_date:this.dateStart,final_date:this.dateEnd};this.$emit("onfilter",e)}},ChangeSelectedUsers:function(e){this.selectedUsers=e},ChangeSelectedServices:function(e){this.selectedServices=e}}},L=V,$=a("8336"),A=a("62ad"),F=a("2e4b"),R=a("169a"),B=a("4bd4"),O=a("0fd9"),U=a("2fa4"),T=a("8654"),j=Object(_["a"])(L,c,d,!1,null,null,null),Y=j.exports;y()(j,{VBtn:$["a"],VCol:A["a"],VDatePicker:F["a"],VDialog:R["a"],VForm:B["a"],VIcon:S["a"],VRow:O["a"],VSpacer:U["a"],VTextField:T["a"]});var N={components:{FiltersReportComponent:Y,userAvatar:l["a"]},props:{headers:{type:Array,default:function(){return[]}},items:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1}},data:function(){return{searchQuery:""}},computed:{isAdmin:function(){return $cookies.get("user").isAdmin},configFormat:function(){return{decimalDigits:0,decimalSeparator:".",thousandsSeparator:",",currencySymbol:"",currencySymbolNumberOfSpaces:0,currencySymbolPosition:"left"}}},methods:{detalle:function(e){this.$router.push({name:"reports-sms",params:{campaign_id:e.id,campaign:e}})},downloadFile:function(e){window.location.assign("http://app.enviamas.pe:81")},onfilter:function(e){this.$emit("onfilter",e)},onreadyfilters:function(){this.$emit("onreadyfilters")},onreadyusers:function(e){this.$emit("onreadyusers",e)},prueba:function(){console.log(this.items)}}},M=N,P=a("b0af"),z=a("99d9"),Q=a("cc20"),G=a("8fea"),J=a("8860"),K=a("e449"),H=Object(_["a"])(M,r,o,!1,null,null,null),W=H.exports;y()(H,{VBtn:$["a"],VCard:P["a"],VCardTitle:z["d"],VChip:Q["a"],VDataTable:G["a"],VIcon:S["a"],VList:J["a"],VListItem:C["a"],VMenu:K["a"],VSpacer:U["a"],VTextField:T["a"]});var Z=a("ed7b"),q=a("5e85"),X=a.n(q),ee={components:{TableReportComponent:W,BtnToReload:Z["a"]},data:function(){return{search_text:"",users:[],reports:[],headers:[{text:"Usuario",value:"user_name"},{text:"Campaña",value:"name"},{text:"Fecha de envío",value:"created_at"},{text:"Estado",value:"status"},{text:"Créditos",value:"total_cost"},{text:"Acciones",value:"actions"}],isLoading:!1,isLoadingDownload:!1}},mounted:function(){this.onreadyusers()},methods:{getReports:function(e){var t=this;this.isLoading=!0,f["a"].post("/userCampaignBetween",e).then((function(e){e.data.success&&(t.reports=e.data.data,console.log(t.reports)),t.isLoading=!1}))},on_filter:function(e){var t=e.users,a=e.services;if(void 0!==t.find((function(e){return 0===e}))){var n=t.indexOf(0);t.splice(n,1)}if(void 0!==a.find((function(e){return 0===e}))){var i=a.indexOf(0);a.splice(i,1)}var s={users:t,services:a,start_date:e.start_date,final_date:e.final_date};this.getReports(s)},onDetail:function(e){this.$router.push({path:"/reports/sms/detail/"+e.id})},onreadyusers:function(e){var t=this;this.isLoading=!0;var a={users:e,services:[1,2],start_date:m()().format("YYYY-MM-DD"),final_date:m()().format("YYYY-MM-DD")};void 0!==e&&f["a"].post("/userCampaignBetween",a).then((function(e){e.data.success&&(t.reports=e.data.data,console.log(t.reports)),t.isLoading=!1}))},descargarExcel:function(){this.isLoadingDownload=!0;var e=[{sheet:"Campañas",columns:[{label:"Usuario",value:"user"},{label:"Email",value:"email"},{label:"Campaña",value:"name"},{label:"Servicio",value:"service"},{label:"Fecha de envio",value:"created_at"},{label:"Estado",value:function(e){return 0===e.status?"cancelado":1===e.status?"finalizado":2===e.status?"pendiente":3===e.status?"procesando":"agendado"}},{label:"Usuario",value:"user"},{label:"Creditos",value:"total_cost"}],content:Object(s["a"])(this.reports)}],t={sheetName:"Reporte",fileName:"Reporte de servicios"};X()(e,t),this.isLoadingDownload=!1}}},te=ee,ae=Object(_["a"])(te,n,i,!1,null,null,null);t["default"]=ae.exports;y()(ae,{VBtn:$["a"],VIcon:S["a"],VSpacer:U["a"]})}}]);